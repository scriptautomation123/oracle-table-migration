{#
==================================================================
Template: POC Schema Creation (Jinja2)
==================================================================
Purpose: Create tables in target schema for POC
==================================================================
#}
-- ==================================================================
-- POC SCHEMA CREATION SCRIPT
-- ==================================================================
-- Purpose: Create tables in target schema
-- Target Schema: {{ target_schema }}
-- Generated: {{ generation_date }}
-- ==================================================================

SET ECHO ON
SET SERVEROUTPUT ON
SET TIMING ON

PROMPT ================================================================
PROMPT POC Schema Creation: {{ target_schema }}
PROMPT ================================================================
PROMPT Creating {{ tables | length }} table(s)
PROMPT ================================================================

{% for table in tables %}
-- ==================================================================
-- Table: {{ table.table_name }}
-- ==================================================================
PROMPT Creating table {{ table.table_name }}...

CREATE TABLE {{ target_schema }}.{{ table.table_name }} (
{%- for column in table.columns %}
    {{ column.name }} {{ column.type }}{% if column.type in ['VARCHAR2', 'CHAR', 'NVARCHAR2', 'NCHAR'] and column.length %}({{ column.length }}){% elif column.type == 'NUMBER' and column.precision %}({{ column.precision }}{% if column.scale is not none %},{{ column.scale }}{% endif %}){% endif %}{% if column.nullable == 'N' %} NOT NULL{% endif %}{% if column.default %} DEFAULT {{ column.default }}{% endif %}{% if not loop.last %},{% endif %}
{%- endfor %}
)
{% if table.storage.tablespace %}TABLESPACE {{ table.storage.tablespace }}{% endif %}
{% if table.storage.pct_free %}PCTFREE {{ table.storage.pct_free }}{% endif %}
{% if table.storage.ini_trans %}INITRANS {{ table.storage.ini_trans }}{% endif %}
{% if table.storage.max_trans %}MAXTRANS {{ table.storage.max_trans }}{% endif %}
{% if table.storage.initial_extent %}STORAGE (INITIAL {{ table.storage.initial_extent }}{% if table.storage.next_extent %} NEXT {{ table.storage.next_extent }}{% endif %}){% endif %}
{% if table.storage.buffer_pool %}BUFFER_POOL {{ table.storage.buffer_pool }}{% endif %};

{% if table.partitioning.is_partitioned %}
-- Partitioning information for {{ table.table_name }}
PROMPT Table {{ table.table_name }} is partitioned:
PROMPT   Type: {{ table.partitioning.partitioning_type }}
PROMPT   Subpartitioning: {{ table.partitioning.subpartitioning_type }}
PROMPT   Partitions: {{ table.partitioning.partition_count }}
{% if table.partitioning.interval %}
PROMPT   Interval: {{ table.partitioning.interval }}
{% endif %}
{% endif %}

{% endfor %}

PROMPT ================================================================
PROMPT Schema creation completed successfully
PROMPT ================================================================
