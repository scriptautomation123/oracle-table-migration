{#
==================================================================
Template: POC Cleanup Script (Jinja2)
==================================================================
Purpose: Clean up existing objects in target schema for POC
==================================================================
#}
-- ==================================================================
-- POC CLEANUP SCRIPT
-- ==================================================================
-- Purpose: Clean up existing objects in target schema
-- Target Schema: {{ target_schema }}
-- Generated: {{ generation_date }}
-- ==================================================================

SET ECHO ON
SET SERVEROUTPUT ON
SET TIMING ON

PROMPT ================================================================
PROMPT POC Cleanup: {{ target_schema }}
PROMPT ================================================================
PROMPT This script will clean up existing objects in the target schema
PROMPT ================================================================

-- Disable constraints to avoid dependency issues
PROMPT Disabling constraints...

{% for table in tables %}
{% if table.constraints %}
-- Disable constraints for {{ table.table_name }}
{% for constraint in table.constraints %}
{% if constraint.type in ['P', 'U', 'R'] %}
ALTER TABLE {{ target_schema }}.{{ table.table_name }} DISABLE CONSTRAINT {{ constraint.name }};
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}

-- Drop tables in reverse dependency order
PROMPT Dropping tables...

{% for table in tables %}
-- Drop table {{ table.table_name }}
DROP TABLE {{ target_schema }}.{{ table.table_name }} CASCADE CONSTRAINTS;
{% endfor %}

-- Drop sequences (if any)
PROMPT Dropping sequences...
{% for sequence in sequences %}
DROP SEQUENCE {{ target_schema }}.{{ sequence.name }};
{% endfor %}

-- Drop views (if any)
PROMPT Dropping views...
{% for view in views %}
DROP VIEW {{ target_schema }}.{{ view.name }};
{% endfor %}

-- Drop procedures and functions (if any)
PROMPT Dropping procedures and functions...
{% for procedure in procedures %}
DROP {{ procedure.type }} {{ target_schema }}.{{ procedure.name }};
{% endfor %}

PROMPT ================================================================
PROMPT Cleanup completed successfully
PROMPT ================================================================
