{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/migration-config.schema.json",
  "title": "Oracle Table Migration Configuration",
  "description": "Configuration schema for Oracle table migration from interval to interval-hash partitioning",
  "type": "object",
  "required": ["metadata", "tables"],

  "properties": {
    "metadata": {
      "type": "object",
      "description": "Metadata about the migration configuration",
      "required": ["generated_date", "schema"],
      "properties": {
        "generated_date": {
          "type": "string",
          "description": "Date and time when configuration was generated",
          "pattern": "^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}$"
        },
        "schema": {
          "type": "string",
          "description": "Oracle schema name",
          "pattern": "^[A-Z][A-Z0-9_$#]*$"
        },
        "environment": {
          "type": "string",
          "description": "Environment name"
        },
        "discovery_criteria": {
          "type": "string",
          "description": "Criteria used for table discovery"
        },
        "total_tables_found": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of tables discovered"
        },
        "tables_selected_for_migration": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of tables enabled for migration"
        }
      }
    },

    "environment_config": {
      "type": "object",
      "description": "Environment-specific configuration",
      "properties": {
        "name": {"type": "string"},
        "tablespaces": {
          "type": "object",
          "properties": {
            "data": {
              "type": "object",
              "properties": {
                "primary": {"type": "string"},
                "lob": {
                  "type": "array",
                  "items": {"type": "string"}
                }
              }
            }
          }
        },
        "subpartition_defaults": {"type": "object"},
        "parallel_defaults": {"type": "object"}
      }
    },

    "tables": {
      "type": "array",
      "description": "Array of table configurations",
      "items": {
        "$ref": "#/definitions/table_config"
      }
    }
  },

  "definitions": {
    "table_config": {
      "type": "object",
      "required": ["enabled", "owner", "table_name", "current_state", "common_settings"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether this table should be migrated"
        },

        "owner": {
          "type": "string",
          "description": "Table owner (schema)",
          "pattern": "^[A-Z][A-Z0-9_$#]*$"
        },

        "table_name": {
          "type": "string",
          "description": "Table name",
          "pattern": "^[A-Z][A-Z0-9_$#]*$"
        },

        "current_state": {
          "type": "object",
          "description": "Complete current table state with all metadata details",
          "required": ["is_partitioned", "partition_type", "size_gb", "row_count", "columns", "lob_storage", "storage_parameters", "indexes", "available_columns"],
          "properties": {
            "is_partitioned": {
              "type": "boolean",
              "description": "Whether table is currently partitioned"
            },
            "partition_type": {
              "type": "string",
              "enum": ["NONE", "RANGE", "LIST", "HASH", "REFERENCE", "SYSTEM"],
              "description": "Current partition type"
            },
            "size_gb": {
              "type": "number",
              "description": "Table size in GB"
            },
            "row_count": {
              "type": "integer",
              "description": "Approximate row count"
            },
            "columns": {
              "type": "array",
              "description": "Array of column metadata for CREATE TABLE statement",
              "items": {
                "type": "object",
                "required": ["name", "type", "length", "precision", "scale", "nullable", "default", "char_length"],
                "properties": {
                  "name": { "type": "string", "description": "Column name" },
                  "type": { "type": "string", "description": "Oracle data type" },
                  "length": { "type": ["integer", "null"], "description": "Data length" },
                  "precision": { "type": ["integer", "null"], "description": "Data precision" },
                  "scale": { "type": ["integer", "null"], "description": "Data scale" },
                  "nullable": { "type": "string", "enum": ["Y", "N"], "description": "Whether column allows NULL" },
                  "default": { "type": ["string", "null"], "description": "Default value" },
                  "char_length": { "type": ["integer", "null"], "description": "Character length (for CHAR/VARCHAR2)" }
                }
              }
            },
            "lob_storage": {
              "type": "array",
              "description": "LOB storage configuration details",
              "items": {
                "type": "object"
              }
            },
            "storage_parameters": {
              "type": "object",
              "description": "Table storage parameters (compression, pctfree, etc.)"
            },
            "indexes": {
              "type": "array",
              "description": "Index definitions with columns and storage",
              "items": {
                "type": "object"
              }
            },
            "available_columns": {
              "type": "object",
              "description": "Available columns for partitioning",
              "properties": {
                "timestamp_columns": {
                  "type": "array",
                  "description": "Timestamp columns suitable for interval partitioning"
                },
                "numeric_columns": {
                  "type": "array", 
                  "description": "Numeric columns suitable for hash partitioning"
                },
                "string_columns": {
                  "type": "array",
                  "description": "String columns suitable for hash partitioning"
                }
              }
            }
          }
        },

        "common_settings": {
          "type": "object",
          "description": "Common configurable settings for migration",
          "required": ["new_table_name", "old_table_name", "migration_action", "target_configuration", "migration_settings"],
          "properties": {
            "new_table_name": {
              "type": "string",
              "description": "Name for the new partitioned table"
            },
            "old_table_name": {
              "type": "string", 
              "description": "Name for the old table backup"
            },
            "migration_action": {
              "type": "string",
              "description": "Type of migration action to perform"
            },
            "target_configuration": {
              "type": "object",
              "description": "Target partitioning configuration"
            },
            "migration_settings": {
              "type": "object",
              "description": "Migration execution settings",
              "properties": {
                "estimated_hours": {
                  "type": "number",
                  "description": "Estimated migration time in hours"
                },
                "priority": {
                  "type": "string",
                  "description": "Migration priority level"
                },
                "validate_data": {
                  "type": "boolean",
                  "description": "Whether to validate data after migration"
                },
                "backup_old_table": {
                  "type": "boolean",
                  "description": "Whether to backup the old table"
                },
                "drop_old_after_days": {
                  "type": "integer",
                  "description": "Days to keep old table before dropping"
                }
              }
            }
          }
        },

        "available_columns": {
          "type": "object",
          "description": "Available columns for partitioning",
          "properties": {
            "timestamp_columns": {
              "type": "array",
              "description": "Columns suitable for interval partitioning",
              "items": {
                "$ref": "#/definitions/column_info"
              }
            },
            "numeric_columns": {
              "type": "array",
              "description": "Numeric columns suitable for hash partitioning",
              "items": {
                "$ref": "#/definitions/column_info"
              }
            },
            "string_columns": {
              "type": "array",
              "description": "String columns suitable for hash partitioning",
              "items": {
                "$ref": "#/definitions/column_info"
              }
            }
          }
        },

        "migration_action": {
          "type": "string",
          "enum": [
            "convert_interval_to_interval_hash",
            "add_interval_hash_partitioning",
            "add_interval_partitioning",
            "add_hash_subpartitions",
            "convert_to_interval_hash"
          ],
          "description": "Type of migration action to perform"
        },

        "target_configuration": {
          "type": "object",
          "description": "Target partition configuration",
          "required": ["partition_type", "partition_column"],
          "properties": {
            "partition_type": {
              "type": "string",
              "enum": ["INTERVAL", "RANGE"],
              "description": "Target partition type"
            },

            "partition_column": {
              "type": ["string", "null"],
              "description": "Column to partition on",
              "pattern": "^[A-Z][A-Z0-9_$#]*$"
            },

            "interval_type": {
              "type": "string",
              "enum": ["HOUR", "DAY", "WEEK", "MONTH"],
              "description": "Interval granularity"
            },

            "interval_value": {
              "type": "integer",
              "minimum": 1,
              "maximum": 999,
              "description": "Interval value (e.g., 1 for 1 month)"
            },

            "initial_partition_value": {
              "type": "string",
              "description": "Initial partition boundary (Oracle TO_DATE format)",
              "pattern": "^TO_DATE\\('.*', '.*'\\)$"
            },

            "subpartition_type": {
              "type": "string",
              "enum": ["HASH", "NONE"],
              "description": "Subpartition type"
            },

            "subpartition_column": {
              "type": ["string", "null"],
              "description": "Column to subpartition on",
              "pattern": "^[A-Z][A-Z0-9_$#]*$"
            },

            "subpartition_count": {
              "type": "integer",
              "minimum": 1,
              "maximum": 1024,
              "description": "Number of hash subpartitions (power of 2 recommended)"
            },

            "tablespace": {
              "type": "string",
              "description": "Tablespace name",
              "pattern": "^[A-Z][A-Z0-9_$#]*$"
            },

            "parallel_degree": {
              "type": "integer",
              "minimum": 1,
              "maximum": 128,
              "description": "Parallel degree for migration operations"
            }
          }
        },

        "migration_settings": {
          "type": "object",
          "description": "Migration execution settings",
          "properties": {
            "estimated_hours": {
              "type": "number",
              "minimum": 0,
              "description": "Estimated migration time in hours"
            },
            "priority": {
              "type": "string",
              "enum": ["HIGH", "MEDIUM", "LOW"],
              "description": "Migration priority"
            },
            "validate_data": {
              "type": "boolean",
              "description": "Whether to validate data after migration"
            },
            "backup_old_table": {
              "type": "boolean",
              "description": "Whether to keep old table as backup"
            },
            "drop_old_after_days": {
              "type": "integer",
              "minimum": 0,
              "description": "Days to wait before dropping old table (0 = immediate)"
            }
          }
        },

        "environment": {
          "type": "string",
          "description": "Environment name"
        }
      }
    },

    "column_info": {
      "type": "object",
      "required": ["name", "type", "nullable"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Column name",
          "pattern": "^[A-Z][A-Z0-9_$#]*$"
        },
        "type": {
          "type": "string",
          "description": "Oracle data type"
        },
        "nullable": {
          "type": "string",
          "enum": ["Y", "N"],
          "description": "Whether column allows NULL"
        }
      }
    }
  }
}
